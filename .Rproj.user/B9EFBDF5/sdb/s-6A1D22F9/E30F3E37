{
    "collab_server" : "",
    "contents" : "---\ntitle: \"Second Parsing\"\noutput: html_notebook\n---\n\n```{r fig.width=12}\nlibrary(tidyverse)\n\neverything = read_csv(\"merged.csv\")\n\nhead(everything)\n\nlabelled = everything %>% \n  mutate(latitude = case_when(\n    is.na(lat) & is.na(LAT) ~ LAT_BING,\n    is.na(lat) ~ LAT,\n    TRUE ~ lat),\n  longitude = case_when(\n    is.na(lon) & is.na(LON) ~ LON_BING,\n    is.na(lon) ~ LON,\n    TRUE ~ lon),\n  name = case_when(\n    is.na(title) & is.na(CityST) ~ Alperin_Place,\n    is.na(title) ~ CityST,\n    TRUE ~ title\n  )\n  ) %>%\n  mutate(longitude = ifelse(is.na(lon),LON,lon)) %>%\n  mutate(source = case_when(\n    is.na(cesta_pops) & !is.na(alperin_pops) ~ \"Alperin-Sheriff Wikipedia set\",\n    is.na(cesta_pops) & is.na(alperin_pops) ~ \"Wikipedia edits not in A-S or CESTA\",\n    !is.na(cesta_pops) & is.na(wiki_pops) ~ \"CESTA only\",    \n    !is.na(cesta_pops) & !is.na(wiki_pops) ~ \"In both Wikipedia and CESTA\",    \n    TRUE ~ \"Other\"\n  ))\n\nlabelled %>% write_csv(\"~/projects/popmaps/merged.csv\")\n\nlabelled %>% filter(is.na(`1790`))\n\nbiggest = labelled %>% filter(!is.na(latitude),is.na(`settlement_type`) | `settlement_type` != \"US State\") %>% group_by(source) %>% filter(!is.na(maxpop)) %>% arrange(-maxpop) %>% sample_n(10,weight=maxpop)\n\n\nlibrary(ggrepel)\nggplot(labelled %>% filter(latitude < 50,longitude < -20) %>% sample_frac()) + aes(x=longitude,y=latitude,label=paste(name,maxpop)) + geom_point(position=\"jitter\",size=.5,alpha=.1) + facet_wrap(~source) + coord_map(proj=\"albers\",y0=30,y1=45) + labs(title=\"Dataset sources\") + geom_text_repel(data=biggest,size=3,color=scales::muted(\"blue\"))\n\n#head(labelled)\n\nbiggest\n```\n\n```{r}\nlabelled %>% filter(grepl(\"Heber Springs|Upper Darby|Washington Court House\",name)) %>% arrange(name)\n```\n\nAdd a new chunk by clicking the *Insert Chunk* button on the toolbar or by pressing *Cmd+Option+I*.\n\nWhen you save the notebook, an HTML file containing the code and output will be saved alongside it (click the *Preview* button or press *Cmd+Shift+K* to preview the HTML file).\nShow in New WindowClear OutputExpand/Collapse Output\nError in install.packages : Updating loaded packages",
    "created" : 1503066148764.000,
    "dirty" : true,
    "encoding" : "UTF-8",
    "folds" : "",
    "hash" : "2982372406",
    "id" : "E30F3E37",
    "lastKnownWriteTime" : 1503368282,
    "last_content_update" : 1503368473915,
    "path" : "~/Dropbox/Gannett/wikipedia_population/Second Parsing.Rmd",
    "project_path" : "Second Parsing.Rmd",
    "properties" : {
        "chunk_output_type" : "inline",
        "tempName" : "Untitled1"
    },
    "relative_order" : 3,
    "source_on_save" : false,
    "source_window" : "",
    "type" : "r_markdown"
}